# MVP要件定義書（概要）

## 1. 目的・背景
- アプリ内ユーザ同士で、即時に少額送金を行える最小限の機能を提供する。
- 送金手数料なし、同一アプリ会員間のみ。

## 2. スコープ（MVP）
- 残高表示
- 送金相手選択
- 金額入力＋任意メッセージ
- 送金実行
- 結果表示  

## 3. 用語定義
- **ユーザ**：アプリ会員。
- **口座**：アプリ内残高を保持する論理口座。
- **送金**：ユーザA→ユーザBの残高移転。
- **預金残高**：ユーザの利用可能額（整数円）。

## 4. アクター
- **一般ユーザ**（送金者／受領者）：アプリログインは別途実装
- **システム**：残高照会・送金処理・履歴記録を実施。

## 5. 前提・制約
- 通貨は日本円（整数円のみ、小数不可）。
- 認証はログイン済み前提。
- アイコンはサーバローカル保存。
- 送金は即時反映・手数料なし。
- メッセージは任意テキスト（上限文字数あり）。

## 6. 画面（概要）
- **ホーム**：ユーザ情報（アイコン／口座番号／氏名／残高）表示、送金相手選択へ遷移可能。
- **送金相手一覧**：自分以外のユーザを氏名＋アイコンで一覧。選択で金額入力画面へ。
- **金額入力**：宛先表示、送金上限（自分の残高）、金額入力、任意メッセージ入力、送金ボタン。
- **完了**：成功／エラー結果を表示（宛先・金額・メッセージ・日時・最新残高）。

## 7. 機能要件（FR）

### FR-01 残高・口座情報の表示
- ユーザはホームで自身のアイコン／口座番号／氏名／預金残高を確認できる。

### FR-02 送金相手の選択
- ユーザは自分以外のユーザを一覧から選び送金相手に指定できる。

### FR-03 送金金額・メッセージ入力
- 宛先情報と上限金額を表示。
- 金額は必須入力、正の整数、0不可、上限超過不可。
- メッセージは任意（上限文字数あり）。
- 入力値が有効な場合のみ送金ボタンを活性化。

### FR-04 送金実行
- システムは残高の最終チェックを行い、送金者残高を減算、受領者残高を加算。
- 送金履歴を保存。
- 成功時は完了画面へ遷移、失敗時はエラーを表示。

### FR-05 結果表示
- 成功時：宛先、金額、メッセージ、日時、最新残高を表示。
- 失敗時：適切なエラーメッセージを表示。

### FR-06 二重送信防止
- 送金処理中はボタンと入力を無効化、処理中表示を行う。

### FR-07 監査・履歴（最小）
- 送金履歴を保持（内部保存のみ、一覧UIはMVPでは不要）。

## 8. ビジネスルール（BR）
- BR-01：送金は送金者≠受領者に限る。
- BR-02：金額は整数円。小数入力不可。
- BR-03：送金額は送金者残高以下でなければならない。
- BR-04：メッセージは任意入力、上限文字数を設ける。
- BR-05：処理は即時反映。未確定や予約は不可。
- BR-06：表示残高は送金後の最新値と整合している必要がある。

## 9. バリデーション要件
- 金額：未入力／非数／0以下／上限超過 → エラー。
- 宛先：存在しない／自分自身 → エラー。
- メッセージ：上限文字数超過 → エラー。
- エラーメッセージはユーザが理解可能な文言。

## 10. 例外・エラー要件
- 残高不足（INSUFFICIENT_FUNDS）
- 無効金額（INVALID_AMOUNT）
- 宛先不正（USER_NOT_FOUND）
- 同時更新失敗（CONFLICT_RETRY）

## 12. 受け入れ条件（例）
- AC-01：残高10,000円から9,999円送金でき、残高1円となる。
- AC-02：残高10,000円で10,001円を入力すると送金できずエラー表示。
- AC-03：自分自身は送金相手一覧に表示されない。
- AC-04：送金成功時、宛先・金額・メッセージ・日時・最新残高が確認できる。
- AC-05：送金中はボタンを再押下できない。
